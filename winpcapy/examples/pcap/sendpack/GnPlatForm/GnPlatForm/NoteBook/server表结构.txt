USE [GuangZhou_Gn]
GO

/****** Object:  Table [dbo].[mpos_gn_common]    Script Date: 04/17/2012 09:11:34 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[mpos_gn_common]') AND type in (N'U'))
DROP TABLE [dbo].[mpos_gn_common]
GO

USE [GuangZhou_Gn]
GO

/****** Object:  Table [dbo].[mpos_gn_common]    Script Date: 04/17/2012 09:11:34 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[mpos_gn_common](
	[gn_id] [int] IDENTITY(1,1) NOT NULL,
	[Online_ID] [bigint] NULL,
	[Session_ID] [bigint] NULL,
	[Start_Date_Time] [datetime] NULL,
	[End_Date_Time] [datetime] NULL,
	[SGSN_IP] [bigint] NULL,
	[SGSN] [nvarchar](30) NULL,
	[GGSN_IP] [bigint] NULL,
	[GGSN] [nvarchar](30) NULL,
	[LAC] [int] NULL,
	[CI] [int] NULL,
	[SAC] [int] NULL,
	[IMSI] [nvarchar](17) NULL,
	[IMEI] [nvarchar](17) NULL,
	[Prefix_IMEI] [nvarchar](8) NULL,
	[MSISDN] [bigint] NULL,
	[APN] [nvarchar](30) NULL,
	[RAT_TYPE] [int] NULL,
	[my_RAT_TYPE] [nvarchar](128) NULL,
	[PROTOCOL] [int] NULL,
	[my_Protocol] [nvarchar](128) NULL,
	[Event_Type] [int] NULL,
	[my_Event_Type] [nvarchar](128) NULL,
	[IP_LEN_UL] [int] NULL,
	[IP_LEN_DL] [int] NULL,
	[Count_Packet_UL] [int] NULL,
	[Count_Packet_DL] [int] NULL,
	[Duration] [decimal](20, 0) NULL,
	[SOURCE_IP] [bigint] NULL,
	[my_SOURCE_IP] [nvarchar](128) NULL,
	[DEST_IP] [bigint] NULL,
	[my_DEST_IP] [nvarchar](128) NULL,
	[SOURCE_PORT] [int] NULL,
	[DEST_PORT] [int] NULL,
	[URI] [nvarchar](1024) NULL,
	[URI_Main] [nvarchar](128) NULL,
	[my_URI_Main] [nvarchar](128) NULL,
	[my_URI_Main_header] [nvarchar](128) NULL,
	[Content_Type] [nvarchar](30) NULL,
	[User_Agent_Main] [nvarchar](30) NULL,
	[Service_TYPE] [int] NULL,
	[my_Service_TYPE] [nvarchar](128) NULL,
	[Sub_Service_Type] [int] NULL,
	[my_Sub_Service_Type] [nvarchar](128) NULL,
	[IsReassemble] [bit] NULL,
	[Delete_PDP] [bit] NULL,
	[Delete_PDP_Direction] [bit] NULL,
	[Abnormal_reason] [int] NULL,
	[my_Abnormal_reason] [nvarchar](128) NULL,
	[Repeat_Count] [int] NULL,
	[Resp] [bit] NULL,
	[Resp_DelayFirst] [int] NULL,
	[Resp_cause] [int] NULL,
	[abort] [int] NULL,
	[Disconnect] [bit] NULL,
	[Result] [bit] NULL,
	[Result_DelayFirst] [int] NULL,
	[MMS_request] [bit] NULL,
	[MMS_resp_status] [int] NULL,
	[From] [nvarchar](30) NULL,
	[To] [nvarchar](30) NULL,
	[Subject] [nvarchar](40) NULL,
	[Delivery_Report] [bit] NULL,
	[Query_Name] [nvarchar](128) NULL,
	[Query_Type] [nvarchar](128) NULL,
	[DNS_TTL] [int] NULL,
	[SP_Address] [bigint] NULL,
	[Identifier] [int] NULL,
	[Is_UserAbnormal] [int] NULL,
	[ErrorPacketLost] [int] NULL,
	[ErrorPacketWired] [int] NULL,
	[ErrorPacketWireless] [int] NULL,
	[Ack] [int] NULL,
	[IpLenDlAck] [int] NULL,
	[IpLenUpAck] [int] NULL,
	[SynDirection] [int] NULL,
 CONSTRAINT [PK_mpos_gn_common] PRIMARY KEY CLUSTERED 
(
	[gn_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO





alter TABLE [Gb_IP_Fragment]
 alter  COLUMN [PacketNum] int  not null

go
alter table [Gb_IP_Fragment] add CONSTRAINT PK__PacketNum PRIMARY KEY (PacketNum);




alter TABLE [Gb_PDP_XID]
 alter  COLUMN [PacketNum] int  not null
 go
 alter TABLE [Gb_PDP_XID]
alter  COLUMN [FileNum] int  not null
go
alter table [Gb_PDP_XID] add CONSTRAINT PK_Gb_PDP_XID PRIMARY KEY (PacketNum,FileNum);

alter TABLE [Gb_XID]
 alter  COLUMN [PacketNum] int  not null
 go
 alter TABLE [Gb_XID]
alter  COLUMN [FileNum] int  not null
go
alter table [Gb_XID] add CONSTRAINT PK_Gb_XID PRIMARY KEY (PacketNum,FileNum);


alter TABLE [Gb_IP_Fragment]
 alter  COLUMN [PacketNum] int  not null
 go
 alter TABLE [Gb_IP_Fragment]
alter  COLUMN [FileNum] int  not null
go
alter table [Gb_IP_Fragment] add CONSTRAINT PK_Gb_IP_Fragment PRIMARY KEY (PacketNum,FileNum);






/****** Script for SelectTopNRows command from SSMS  ******/
SELECT
      min([PacketTime]),
    max([PacketTime])

  FROM [GuangZhou_Gn].[dbo].[Gb_IP_Fragment]
  go
  select distinct  bssgp_lac
  FROM [GuangZhou_Gn].[dbo].[Gb_IP_Fragment]
  

     alter TABLE  [GuangZhou_Gn].[dbo].[url_result]
alter  COLUMN [urlid] int  not null

go
alter table [GuangZhou_Gn].[dbo].[url_result] add CONSTRAINT PK__urlid PRIMARY KEY (urlid);


 alter TABLE  [GuangZhou_Gn].[dbo].[imeitype]
alter  COLUMN  [imei] nvarchar(50) not null

go
alter table [GuangZhou_Gn].[dbo].[imeitype] add CONSTRAINT PK_imei PRIMARY KEY (imei);



USE [Guangzhou_Gi]
GO
select * into imeitype from GuangZhou_Gn.dbo.imeitype

insert into [Guangzhou_Gi].[dbo].[imeitype]

select cast([IMEI] as decimal) as [imei]
      ,[厂商] as [imeifactory]
      ,[型号] as [imeiname]

  FROM [Guangzhou_Gi].[dbo].[NEW$]
  where [IMEI] is not null
